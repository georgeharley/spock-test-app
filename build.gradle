/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */
buildscript {
    repositories {
        mavenCentral()
    }
}

apply plugin: 'groovy'
version = '1.0'
sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
    mavenCentral()
    maven { url "https://oss.sonatype.org/content/repositories/snapshots/" }
}

dependencies {
    testImplementation 'org.codehaus.groovy:groovy-all:2.5.9'
    testImplementation platform('org.spockframework:spock-bom:2.0-groovy-2.5-SNAPSHOT')
    testImplementation 'org.spockframework:spock-core'
}

task uberJar(type: Jar) {
    description "Create uber jar (except for Spock types)"
    archiveBaseName = 'all-tests'
    from files(sourceSets.test.output.classesDirs)
    from files(sourceSets.test.output.resourcesDir)
    from {
        configurations.testRuntimeClasspath
                .filter {
                    !it.name.startsWith("spock-")
                }
                .collect {
                    it.isDirectory() ? it : zipTree(it)
                }
    }
    with jar
}

task collectSpockJars(type: Copy) {
    description "Copy Spock Jars into folder libs"
    into "$buildDir/libs"
    from configurations.testRuntimeClasspath.filter {
        it.name.startsWith("spock-")
    }
}

test {
    useJUnitPlatform()
    testLogging {
        events 'passed', 'skipped', 'failed'
    }
}